# /register

mutation Register($registerInput: RegisterInput!) {
  register(registerInput: $registerInput)
}

# /login, /lti/:ltiUuid

mutation Login($loginInput: LoginInput!) {
  login(loginInput: $loginInput)
}

mutation ClaimJwt($ltiUuid: String!) {
  claimJwt(ltiUuid: $ltiUuid)
}

# /changePassword

mutation ChangePassword($changePasswordInput: ChangePasswordInput!) {
  changePassword(changePasswordInput: $changePasswordInput)
}

# /

query AllExercises {
  exercises {
    id
    title
  }
}

# /createExercise

mutation CreateExercise($exerciseInput: GraphQLExerciseInput!) {
  createExercise(exerciseInput: $exerciseInput)
}

# /exercises/:exerciseId

fragment ExerciseOverview on Exercise {
  title
  text
  solutionSubmitted
  allUsersWithSolution
  corrected
  allUsersWithCorrection
}

query ExerciseOverview($exerciseId: Int!) {
  exercise(exerciseId: $exerciseId) {
    ...ExerciseOverview
  }
}

# /exercise/:exerciseId/solutions/submit

fragment ExerciseTaskDefinition on Exercise {
  title
  text
}

query ExerciseTaskDefinition($exerciseId: Int!) {
  exercise(exerciseId: $exerciseId) {
    ...ExerciseTaskDefinition
  }
}

mutation SubmitSolution($exerciseId: Int!, $userSolution: GraphQLUserSolutionInput!) {
  exerciseMutations(exerciseId: $exerciseId) {
    submitSolution(userSolution: $userSolution)
  }
}

# TODO!

fragment FlatSolutionNodeMatch on FlatSolutionNodeMatch {
  userNodeId
  sampleNodeId
}

fragment FlatCorrection on FlatCorrection {
  sampleSolution {
    ...FlatSolutionNode
  }
  userSolution {
    ...FlatSolutionNode
  }
  matchingResult {
    ...FlatSolutionNodeMatch
  }
}

query NewCorrection($exerciseId: Int!, $username: String!) {
  exercise(exerciseId: $exerciseId) {
    flatCorrectionForUser(username: $username) {
      ...FlatCorrection
    }
  }
}

# /exercises/:exerciseId/solutions/:username/correctSolution, /exercises/:exerciseId/solutions/:username/updateCorrection

fragment FlatSolutionNode on FlatSolutionNode {
  id
  childIndex
  text
  applicability
  subTexts {
    text
    applicability
  }
  parentId
}

query CorrectSolutionValues($exerciseId: Int!, $username: String!) {
  exercise(exerciseId: $exerciseId) {
    sampleSolutionAsJson
    solutionForUserAsJson(username: $username)
  }
}

query UpdateCorrectionValues($exerciseId: Int!, $username: String!) {
  exercise(exerciseId: $exerciseId) {
    correctionForUserAsJson(username: $username)
  }
}

mutation SubmitCorrection($exerciseId: Int!, $correctionInput: GraphQLCorrectionInput!) {
  exerciseMutations(exerciseId: $exerciseId) {
    submitCorrection(correctionInput: $correctionInput)
  }
}
