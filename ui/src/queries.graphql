# /register

mutation Register($registerInput: RegisterInput!) {
  register(registerInput: $registerInput)
}

# /login

fragment LoginResult on LoginResult {
  username
  name
  rights
  jwt
}

mutation Login($loginInput: LoginInput!) {
  login(loginInput: $loginInput) {
    ...LoginResult
  }
}

# /

query AllExercises {
  exercises {
    id
    title
  }
}

# /changePassword

mutation ChangePassword($changePasswordInput: ChangePasswordInput!) {
  changePassword(changePasswordInput: $changePasswordInput)
}

# /correctors, /admins

query UsersWithRights($rights: Rights!) {
  adminQueries {
    usersWithRights(rights: $rights)
  }
}

query UsersByPrefix($prefix: String!) {
  adminQueries {
    usersByPrefix(prefix: $prefix)
  }
}

mutation ChangeUserRights($username: String!, $rights: Rights!) {
  adminMutations {
    changeUserRights(username: $username, rights: $rights)
  }
}

# /createExercise

mutation AddExercise($exerciseInput: ExerciseInput!) {
  adminMutations {
    addExercise(exerciseInput: $exerciseInput)
  }
}

# /exercises/:exerciseId

query ExerciseOverview($exerciseId: Int!) {
  exercise(exerciseId: $exerciseId) {
    title
    text
    solutionSubmitted
    allUsersWithSolution
  }
}

# /exercise/:exerciseId/submitSolution

mutation SubmitSolutionForUser($exerciseId: Int!, $solution: SubmitSolutionInput!) {
  exerciseMutations(exerciseId: $exerciseId)  {
    submitSolution( solution: $solution)
  }
}

fragment ExerciseTaskDefinition on Exercise {
  title
  text
}

query SubmitSolution($exerciseId: Int!) {
  exercise(exerciseId: $exerciseId) {
    ...ExerciseTaskDefinition
  }
}

# /exercises/:exerciseId/solutions/:username/correct

fragment SolutionEntrySubText on SolutionEntrySubText {
  text
  applicability
}

fragment FlatSolutionEntry on FlatSolutionEntry {
  id
  text
  applicability
  parentId
  subTexts {
    ...SolutionEntrySubText
  }
}

fragment ExerciseSolutions on Exercise {
  sampleSolution {
    ...FlatSolutionEntry
  }
  maybeUserSolution: solutionForUser(username: $username) {
    ...FlatSolutionEntry
  }
}

query CorrectExercise($exerciseId: Int!, $username: String!) {
  exercise(exerciseId: $exerciseId) {
    ...ExerciseSolutions
  }
}

mutation SaveMatch($exerciseId: Int!, $username: String!, $sampleSolutionNodeId: Int!, $learnerSolutionNodeId: Int!) {
  exercise: exerciseMutations(exerciseId: $exerciseId)  {
    solution: userSolutionMutations(username: $username) {
      saveMatch(sampleSolutionNodeId: $sampleSolutionNodeId, learnerSolutionNodeId: $learnerSolutionNodeId)
    }
  }
}

mutation SubmitCorrection($exerciseId: Int!, $username: String!, $entryCorrections: [EntryCorrectionInput!]!) {
  exercise: exerciseMutations(exerciseId: $exerciseId) {
    solution: userSolutionMutations(username: $username) {
      submitCorrection(entryCorrections: $entryCorrections)
    }
  }
}
