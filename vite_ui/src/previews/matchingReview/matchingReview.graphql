fragment MatchingReviewSolNode on SolutionNode {
  ...PreviewSolNode
  paragraphCitationLocations {
    ...ParagraphCitationLocation
  }
}

# basic data

query MatchingReview($exerciseId: Int!) {
  exercise(exerciseId: $exerciseId) {
    title
    sampleSolutionNodes: sampleSolution {
      ...MatchingReviewSolNode
    }
    usernames: userSolutions {
      username
    }
  }
}

# single user solution

fragment ISolutionNodeMatch on ISolutionNodeMatch {
  sampleNodeId
  userNodeId
  matchStatus
  certainty
}

fragment GoldStandardMatch on SolutionNodeMatch {
  ...ISolutionNodeMatch
}

fragment WordWithRelatedWords on WordWithRelatedWords {
  word
  synonyms
  antonyms
}

fragment WordMatchingResult on WordMatchingResult {
  matches {
    sampleValue {
      ...WordWithRelatedWords
    }
    userValue {
      ...WordWithRelatedWords
    }
  }
  notMatchedSample {
    ...WordWithRelatedWords
  }
  notMatchedUser {
    ...WordWithRelatedWords
  }
  certainty
}

fragment ParagraphMatchingResult on ParagraphMatchingResult {
  matches {
    sampleValue {
      ...ParagraphCitation
    }
    userValue {
      ...ParagraphCitation
    }
  }
  notMatchedSample {
    ...ParagraphCitation
  }
  notMatchedUser {
    ...ParagraphCitation
  }
  certainty
}

fragment SolNodeMatchExplanation on SolutionNodeMatchExplanation {
  maybeWordMatchingResult {
    ...WordMatchingResult
  }
  maybePararaphMatchingResult {
    ...ParagraphMatchingResult
  }
  certainty
}

fragment DefaultSolutionNodeMatch on DefaultSolutionNodeMatch {
  ...ISolutionNodeMatch
  maybeExplanation {
    ...SolNodeMatchExplanation
  }
}

query MatchingReviewUserSolution($exerciseId: Int!, $username: String!) {
  exercise(exerciseId: $exerciseId) {
    userSolution(username: $username) {
      userSolutionNodes: nodes {
        ...MatchingReviewSolNode
      }
      goldStandardMatches: matches {
        ...GoldStandardMatch
      }
      correctionResult: performCurrentCorrection {
        matches {
          ...DefaultSolutionNodeMatch
        }
      }
    }
  }
}

# explain new match
query PreviewMatch($exerciseId: Int!, $username: String!, $sampleNodeId: Int!, $userNodeId: Int!) {
  exercise(exerciseId: $exerciseId) {
    userSolution(username: $username) {
      node(userSolutionNodeId: $userNodeId) {
        previewMatchAgainst(sampleSolutionNodeId: $sampleNodeId) {
          ...DefaultSolutionNodeMatch
        }
      }
    }
  }
}
