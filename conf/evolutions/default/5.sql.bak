-- !Ups
create view if not exists example_view as
select mat.exercise_id,
  mat.username,
  mat.sample_node_id,
  mat.user_node_id,
  anno.awaited_paragraph,
  if(count(anno.awaited_paragraph) > 0, 'Partially', 'Unspecified') as anno_count
from solution_node_matches as mat
  left join paragraph_citation_annotations as anno on mat.username = anno.username
  and mat.exercise_id = anno.exercise_id
  and mat.sample_node_id = anno.sample_node_id
  and mat.user_node_id = anno.user_node_id
group by mat.exercise_id,
  mat.username,
  mat.sample_node_id,
  mat.user_node_id;

-- !Downs
drop view if exists example_view;
